{"version":3,"sources":["../../src/providers/authentication-service/authentication-service.ts","../../node_modules/@angular/core/@angular lazy","../../src lazy","../../src/pages/home/home.ts","../../src/app/main.ts","../../src/app/app.module.ts","../../src/app/app.component.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import { Injectable } from '@angular/core';\nimport 'rxjs/add/operator/map';\nimport 'rxjs/add/operator/filter';\nimport * as auth0 from 'auth0-js';\nimport { Storage } from '@ionic/storage';\n\n@Injectable()\nexport class AuthenticationService {\n  isAuthenticated = false;\n\n  auth0 = new auth0.WebAuth({\n    clientID: '6FRJgAN481GYLr0BR0bO6NV397j4ZAnK',\n    domain: 'sonnenielsen.eu.auth0.com',\n    responseType: 'token id_token',\n    audience: 'https://seekapi.azurewebsites.net',\n    redirectUri: 'https://seekui-dev.azurewebsites.net',\n    scope: 'openid email',\n  });\n\n  constructor(public storage: Storage) { }\n\n  public login(): Promise<any> {\n    return new Promise((resolve, reject) => {\n    this.auth0.authorize();\n    resolve('Redirected');\n    })\n  }\n\n\n  public grabAndParseToken(): Promise<any> {\n\n    return new Promise((resolve, reject) => {\n      this.auth0.parseHash({ _idTokenVerification: false },(err, authResult) => {\n        if (authResult && authResult.accessToken && authResult.idToken) {\n          window.location.hash = '';\n          console.log('This is the location when setSession is called: ',window.location);\n          this.setSession(authResult).then(() => resolve(true));\n        } else if (err) {\n          reject(err);\n        }\n      });\n    });\n  }\n\n  private setSession(authResult): Promise<any> {\n    return new Promise((resolve, reject) => {\n      // Set the time that the access token will expire at\n      const expiresAt = JSON.stringify((authResult.expiresIn * 1000) + new Date().getTime());\n      this.storage.ready().then(() => this.storage.set('access_token', authResult.accessToken))\n        .then(() => { return this.storage.set('id_token', authResult.idToken); })\n        .then(() => { return this.storage.set('expires_at', expiresAt) })\n        .then(() => { return this.storage.get('expires_at') })\n        .then((result => console.log('This was stored by setSession', result)))\n        .then(() => resolve('Authorized successfully'))\n        .catch(error => {\n          console.log(error);\n        })\n    })\n  }\n\n  public logout(): Promise<any> {\n    return new Promise((resolve, reject) => {\n    // Remove tokens and expiry time from storage\n      this.storage.ready().then(() => this.storage.remove('access_token'))\n      .then(() => { return this.storage.remove('id_token') })\n      .then(() => { return this.storage.remove('expires_at') })\n      .then(() => resolve())\n      .catch(error => {\n        console.log(error);\n      })\n      this.isAuthenticated = false;\n      console.log('Logged out successfully');\n    })\n  }    \n\n  public checkAuthentication(): Promise<any> {\n    return new Promise((resolve, reject) => {\n\n      this.storage.ready().then(() => this.storage.get('expires_at'))\n        .then((result) => {console.log('Storage ready!'); return result})\n        .then((result) => {\n          console.log(window.location);\n          console.log('This was in storage: ',result);\n          // Check whether the current time is past the\n          // access token's expiry time\n          if (new Date().getTime() < JSON.parse(result)) {\n            console.log('Not expired: Authenticated');\n            this.isAuthenticated = true;\n            resolve();\n          }\n          else {\n            // Else redirect to login\n            console.log('Expired: Not authenticated!');\n            this.login()\n              .then(() => { return this.grabAndParseToken() })          \n              .then((authenticationStatus) => {\n                if (authenticationStatus) {\n                  console.log('Successfully authenticated!', authenticationStatus);\n                  this.isAuthenticated = true;\n                  resolve();\n                }\n                else {\n                  console.log('Failed authentication!', authenticationStatus);\n                  this.isAuthenticated = false;\n                  reject(authenticationStatus);\n                }\n              })\n          }\n        })\n    })\n\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/providers/authentication-service/authentication-service.ts","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncatched exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 117;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/@angular/core/@angular lazy\n// module id = 117\n// module chunks = 0","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncatched exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 159;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src lazy\n// module id = 159\n// module chunks = 0","import { Component } from '@angular/core';\nimport { NavController, NavParams, LoadingController } from 'ionic-angular';\nimport { AuthenticationService } from '../../providers/authentication-service/authentication-service';\nimport { Storage } from '@ionic/storage';\n\n@Component({\n  selector: 'page-home',\n  templateUrl: 'home.html',\n})\nexport class HomePage {\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, public auth: AuthenticationService, public storage: Storage, public loadingCtrl: LoadingController) {\n\n  }\n\n  ionViewDidLoad() {\n  }\n\n  logout(){\n    this.auth.logout()\n      .then(() => {return this.auth.checkAuthentication()})\n      .then((result) => {console.log('Logged back in: ', result)})\n      .catch(error => {\n        console.log(error);\n      })\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts","import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app.module';\n\nplatformBrowserDynamic().bootstrapModule(AppModule);\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/main.ts","import { BrowserModule } from '@angular/platform-browser';\nimport { ErrorHandler, NgModule } from '@angular/core';\nimport { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';\nimport { SplashScreen } from '@ionic-native/splash-screen';\nimport { StatusBar } from '@ionic-native/status-bar';\nimport { IonicStorageModule } from '@ionic/storage';\n\nimport { MyApp } from './app.component';\nimport { HomePage } from '../pages/home/home';\nimport { AuthenticationService } from '../providers/authentication-service/authentication-service';\n\n@NgModule({\n  declarations: [\n    MyApp,\n    HomePage\n  ],\n  imports: [\n    BrowserModule,\n    IonicModule.forRoot(MyApp),\n    IonicStorageModule.forRoot({\n      name: '__mydb',\n      driverOrder: ['indexeddb', 'websql','localstorage']\n    })\n  ],\n  bootstrap: [IonicApp],\n  entryComponents: [\n    MyApp,\n    HomePage\n  ],\n  providers: [\n    StatusBar,\n    SplashScreen,\n    {provide: ErrorHandler, useClass: IonicErrorHandler},\n    AuthenticationService,\n    Storage\n  ]\n})\nexport class AppModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.module.ts","import { Component } from '@angular/core';\nimport { Platform, LoadingController } from 'ionic-angular';\nimport { StatusBar } from '@ionic-native/status-bar';\nimport { SplashScreen } from '@ionic-native/splash-screen';\nimport { AuthenticationService} from '../providers/authentication-service/authentication-service';\nimport { Storage } from '@ionic/storage';\n\nimport { HomePage } from '../pages/home/home';\n@Component({\n  templateUrl: 'app.html'\n})\nexport class MyApp {\n  rootPage: any = HomePage;\n\n  constructor(platform: Platform, statusBar: StatusBar, splashScreen: SplashScreen, public auth: AuthenticationService, public storage: Storage, public loadingCtrl: LoadingController) {\n    let loading = this.loadingCtrl.create({\n      content: 'Authenticating...'\n    });\n\n    loading.present();\n    this.auth.checkAuthentication().then(() => loading.dismiss() );\n\n\n    platform.ready().then(() => {\n      // Okay, so the platform is ready and our plugins are available.\n      // Here you can do any higher level native things you might need.\n      statusBar.styleDefault();\n      splashScreen.hide();\n    });\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.component.ts"],"sourceRoot":""}